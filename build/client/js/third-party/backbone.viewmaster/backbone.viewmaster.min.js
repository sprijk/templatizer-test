(function(){function r(e){return n.isArray(e)?e:[e]}function i(e){return e.prototype&&e===e.prototype.constructor}var e="1.2.2",t=this.Backbone,n=this._;typeof require=="function"&&(t||(t=require("backbone")),n||(n=require("underscore")));var s=t.View.extend({constructor:function(){t.View.prototype.constructor.apply(this,arguments),this.rendered=!1,this.parent=null,this._views={},this._remove=[],this._dirty={}},template:function(){throw new Error("Template function not defined!")},context:function(){return this.model?this.model.toJSON():{}},render:function(e){return e=n.extend({},e),this.eachView(function(e,t){t.$el.detach()}),e.detached=!0,this.$el.html(this.template(this.context())),this.afterTemplate(),this.rendered=!0,this.refreshViews(e),this},afterTemplate:function(){},refreshViews:function(e){e=n.extend({},e);var t=this,r=this._dirty,i;while(i=this._remove.shift())i.remove();return this.eachView(function(n,i){var s=r[n]||e.force;s&&!e.detached&&i.$el.detach(),(!i.rendered||e.force)&&i.render(e),(s||e.detached)&&t.$(n).append(i.el)}),this._dirty={},this},_removeParent:function(){if(!this.parent)return;var e;for(e in this.parent._views)this.parent._views[e]=n.without(this.parent._views[e],this);return this.parent=null,this},_prepareViews:function(e){var t=this;return e=n.map(r(e),n.bind(this._createInstance,this)),n.each(e,function(e){e.parent&&e.parent!==t&&e._removeParent(),e.parent=t}),e},_createInstance:function(e){return i(e)?new e({model:this.model,collection:this.collection}):e},bubble:function(){var e=n.toArray(arguments);return this.trigger.apply(this,e),this.parent&&this.parent.bubble.apply(this.parent,e),this},broadcast:function(){var e=n.toArray(arguments);return this.trigger.apply(this,e),this.eachView(function(t,n){n.broadcast.apply(n,e)}),this},eachView:function(e){n.each(this._views,function(t,r){n.each(t,function(t){e(r,t)})})},setView:function(e,t){var r;t=this._prepareViews(t);if(r=this._views[e])this._remove=this._remove.concat(n.difference(r,t));return this._views[e]=t,this._dirty[e]=!0,this},insertView:function(e,t,n){var r;return n=this._prepareViews(n),(r=this._views[e])?r.slice().splice.apply(r,[t,0].concat(n)):this._views[e]=n,this._dirty[e]=!0,this},appendView:function(e,t){return this._views[e]=(this._views[e]||[]).concat(this._prepareViews(t)),this._dirty[e]=!0,this},prependView:function(e,t){return this._views[e]=this._prepareViews(t).concat(this._views[e]||[]),this._dirty[e]=!0,this},getViews:function(e){var t;return(t=this._views[e])?t.slice():null},detach:function(){return this._removeParent(),this.$el.detach(),this},remove:function(){return t.View.prototype.remove.apply(this,arguments),this._removeParent(),this.eachView(function(e,t){t.remove()}),this}});s.VERSION=e,typeof module!="undefined"?module.exports=t.Viewmaster:t.Viewmaster=t.ViewMaster=s})();